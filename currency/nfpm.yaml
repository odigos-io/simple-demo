name: odigos-demo-currency
# arch/version set by Docker build args (TARGETARCH, VERSION) in package stage
arch: ${TARGETARCH}
platform: linux
version: ${VERSION}
section: default
priority: extra
maintainer: Odigos <info@odigos.io>
vendor: Odigos
homepage: https://odigos.io
description: |
  Demo PHP micro-service that returns a fake currency conversion rate.
  Part of the Odigos example stack.
contents:
- src: distribution/systemd.service
  dst: /lib/systemd/system/odigos-demo-currency.service
- src: ./dist/app
  dst: /opt/odigos-demo-currency
- src: distribution/php-fpm.conf
  dst: /etc/odigos-demo-currency/php-fpm.conf
- src: distribution/nginx.conf
  dst: /etc/odigos-demo-currency/odigos-demo-currency.nginx.conf
- src: distribution/disable-www.conf
  dst: /etc/odigos-demo-currency/disable-www.conf
scripts:
  preinstall: ./distribution/preinstall.sh
  postinstall: ./distribution/postinstall.sh
  preremove: ./distribution/preremove.sh
  postremove: ./distribution/postremove.sh
overrides:
  rpm:
    depends:
    - php-cli
    - php-fpm
    - nginx
    contents:
    - src: distribution/systemd.service.rpm
      dst: /lib/systemd/system/odigos-demo-currency.service
    - src: ./dist/app
      dst: /opt/odigos-demo-currency
    - src: distribution/php-fpm.conf
      dst: /etc/odigos-demo-currency/php-fpm.conf
    - src: distribution/nginx.conf
      dst: /etc/odigos-demo-currency/odigos-demo-currency.nginx.conf
    - src: distribution/disable-www.conf
      dst: /etc/odigos-demo-currency/disable-www.conf
  deb:
    depends:
    - php-cli (>= 8.3)
    - php8.3-fpm
    - nginx
    contents:
    - src: distribution/systemd.service
      dst: /lib/systemd/system/odigos-demo-currency.service
    - src: ./dist/app
      dst: /opt/odigos-demo-currency
    - src: distribution/php-fpm.conf
      dst: /etc/odigos-demo-currency/php-fpm.conf
    - src: distribution/nginx.conf
      dst: /etc/odigos-demo-currency/odigos-demo-currency.nginx.conf
    - src: distribution/disable-www.conf
      dst: /etc/odigos-demo-currency/disable-www.conf
